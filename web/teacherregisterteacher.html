<!DOCTYPE html>  
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register Teacher</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>REGISTER TEACHER</h1>
<div class="container panel">
    <div class="form-group">
        <label>ID NUMBER:</label>
        <input type="text" id="teacherId">
        <label>NAME:</label>
        <input type="text" id="teacherName">
        <label>PASSWORD:</label>
        <input type="password" id="teacherPassword">
        <button id="addTeacherBtn">ADD TEACHER</button>
        <button id="updateTeacherBtn">UPDATE TEACHER</button>
        <button id="deleteTeacherBtn">DELETE TEACHER</button>
    </div>

    <h3>Registered Teachers</h3>
    <table id="teachersTable">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Password</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
function loadTeachers() {
    fetch("AttendanceServlet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "getAllTeachers" })
    }).then(res => res.json()).then(data => {
        const tbody = document.querySelector("#teachersTable tbody");
        tbody.innerHTML = "";
        data.data.forEach(t => {
            const tr = document.createElement("tr");
            tr.dataset.teacherId = t.id;
            tr.innerHTML = `<td>${t.id}</td><td>${t.name}</td><td>${t.password}</td>`;
            tbody.appendChild(tr);
        });
    });
}

loadTeachers();

let selectedTeacher = null;
document.querySelector("#teachersTable tbody").addEventListener("click", e => {
    if(e.target.tagName === "TD") {
        document.querySelectorAll("#teachersTable tr").forEach(r => r.classList.remove("selected"));
        const tr = e.target.closest("tr");
        tr.classList.add("selected");
        selectedTeacher = tr;
        document.getElementById("teacherId").value = tr.cells[0].textContent;
        document.getElementById("teacherName").value = tr.cells[1].textContent;
        document.getElementById("teacherPassword").value = tr.cells[2].textContent;
    }
});

document.getElementById("addTeacherBtn").addEventListener("click", () => {
    const teacher = {
        id: parseInt(document.getElementById("teacherId").value),
        name: document.getElementById("teacherName").value,
        password: document.getElementById("teacherPassword").value
    };
    fetch("AttendanceServlet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "addTeacher", teacher })
    }).then(res => res.json()).then(data => {
        if(data.status === "success") loadTeachers();
        else alert(data.message);
    });
});

document.getElementById("updateTeacherBtn").addEventListener("click", () => {
    if(!selectedTeacher) return alert("Select a teacher first.");
    const teacher = {
        id: parseInt(document.getElementById("teacherId").value),
        name: document.getElementById("teacherName").value,
        password: document.getElementById("teacherPassword").value
    };
    fetch("AttendanceServlet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "updateTeacher", teacher })
    }).then(res => res.json()).then(data => {
        if(data.status === "success") loadTeachers();
        else alert(data.message);
    });
});

document.getElementById("deleteTeacherBtn").addEventListener("click", () => {
    if(!selectedTeacher) return alert("Select a teacher first.");
    fetch("AttendanceServlet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "deleteTeacher", id: parseInt(selectedTeacher.dataset.teacherId) })
    }).then(res => res.json()).then(data => {
        if(data.status === "success") loadTeachers();
        else alert(data.message);
    });
});
</script>
</body>
</html>
